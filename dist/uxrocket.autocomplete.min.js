/*! UX Rocket Autocomplete 
 *  UX Rocket Autocomplete: A jQueryUI autocomplete wrapper 
 *  @author Bilal Cinarli <bcinarli@gmail.com> (http://bcinarli.com/) 
 *  @version 2.0.2 
 *  @build Wed Mar 29 2017 14:25:57 GMT+0300 (+03) 
 */
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(t){"use strict";var e,s=1,i="uxrAutocomplete",a={type:"list",item:10,service:null,minLength:2,queryType:"GET",formdata:null,hidden:null,template:null,highlight:!0,arrowSelection:!1,arrowNavigation:!0,cache:!1,debounce:0,searchTerm:"term",customProp:!1,onReady:!1,onSearch:!1,onSelect:!1,onEnter:!1,onButtonClick:!1,onClearCache:!1,onUpdate:!1,onRemove:!1},n={list:{item:'<li data-id="{{id}}" class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       {{{name}}}   </a></li>'},image:{item:'<li data-id="{{id}}" class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       <span class="item-image"><img src="{{image}}"/></span>        {{{name}}}   </a></li>'},category:{head:'<li class="uxr-autocomplete-category">   <span class="uxr-autocomplete-category-head" title="{{category}}">{{category}}</span></li>',item:'<li data-id="{{id}}" class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       {{{name}}}   </a></li>'},tree:{head:'<li class="uxr-autocomplete-category">   <span class="uxr-autocomplete-category-head" title="{{category}}">{{category}}</span></li>',item:'<li data-id="{{id}}" class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       <span class="item-image"><img src="{{image}}"/></span>        {{{name}}}   </a></li>'}},o={click:"click."+i,keyup:"keyup."+i,input:"input."+i,blur:"blur."+i},r={codes:{13:"return",27:"esc",37:"left",38:"up",39:"right",40:"down"},"return":13,esc:27,left:37,up:38,right:39,down:40},l={prefix:"uxr-",rocket:"uxRocket",data:i,name:"autocomplete",wrap:"uxr-plugin-wrap",classes:{wrap:"wrap",ready:"ready",magnify:"magnify",loading:"loading",select:"select",category:"category",option:"option",matched:"matched",highlight:"highlight",selected:"selected"}},c=function(e,n,o){var r=t(e);this._instance=s,this._name=i,this._defaults=a,this.el=e,this.$el=r,this.id="uxr-autocomplete-select-"+s,this.selector=o,this.terms={},this.options=t.extend(!0,{},a,n,r.data()),s++,this.lastTerm="as",this.init()};t.extend(c.prototype,{init:function(){var t=this.$el.data(l.rocket)||{};this.$el.addClass(h.getClassname("ready")),t[l.data]={hasWrapper:!0,wrapper:l.wrap,ready:h.getClassname("ready"),selector:this.selector,options:this.options},this.$el.data(l.rocket,t),this.setLayout(),this.prepareContainer(),this.prepareSource(),h.callback(this.options.onReady),this.bindUIActions(),this.setTemplate()},handleClasses:function(){this.classList=this.$el.context.className.replace(h.getClassname("ready"),""),"."===this.selector.charAt(0)&&(this.classList=this.classList.replace(this.selector.substr(1),"")),this.classList+=l.wrap+" "+h.getClassname("wrap")+" "+h.getClassname("wrap")+"-"+this._instance,this.classList=t.trim(this.classList)},removeClasses:function(){this.$el.removeClass(h.getClassname("ready")),this.$el.parent().removeClass(this.classList.replace(l.wrap,""))},handleWrapper:function(){this.$el.parent().is("."+l.wrap)?this.$el.parent().addClass(this.classList):this.$el.wrap('<span class="'+this.classList+'"></span>')},addIcon:function(){this.$el.after('<i class="'+h.getClassname("magnify")+'"></i>'),this.$icon=this.$el.next("."+h.getClassname("magnify"))},setLayout:function(){this.handleClasses(),this.handleWrapper(),this.addIcon()},startLoading:function(){this.$icon.addClass(h.getClassname("loading"))},stopLoading:function(){this.$icon.removeClass(h.getClassname("loading"))},removeLayout:function(){var t=this,e=t.$el.data(l.rocket);Object.keys&&1===Object.keys(e).length?t.$el.unwrap():t.$el.parent().removeClass(l.wrap),t.$el.next("."+h.getClassname("magnify")).remove()},removeContainer:function(){t("#"+this.id).remove()},setTemplate:function(){this.template=null,null===this.options.template?this.template=n[this.options.type]||n.list:this.template=this.options.template},bindUIActions:function(){var e=this;e.$el.on(o.keyup+" "+o.input,h.debounce(function(s){var i=t(this).val(),a=i.length;a>=e.options.minLength&&e.onKeyup(s),0===a&&e.hideContainer()},e.options.debounce)),e.$el.on(o.blur,function(){e.onBlur()}),e.$list.on(o.click,"."+h.getClassname("option"),function(t){t.preventDefault(),e.select(t)}),t("body").on("DOMNodeRemoved",function(t){t.target===e.el&&e.cleanUp()})},select:function(e){var s=e instanceof jQuery?e:t(e.currentTarget);s.siblings().removeClass(h.getClassname("selected")).end().addClass(h.getClassname("selected")),this.setValue(s),this.hideContainer(),h.callback(this.options.onSelect)},setValue:function(e){var s=e.text().trim();this.options.hidden&&t(this.options.hidden).val(e.data("id")),""===s&&(s=this.lastTerm),this.$el.val(s)},unbindUIActions:function(){this.$el.off("."+i)},onKeyup:function(t){t.keyCode===r.up||t.keyCode===r.down?this.onVerticalArrow(r.codes[t.keyCode]):t.keyCode===r["return"]?this.$list.is(":visible")&&this.select(this.$list.find("."+h.getClassname("highlight"))):t.keyCode===r.esc?this.hideContainer():(this.lastTerm=this.$el.val().toLowerCase(),this.search())},onBlur:function(){var t=this;setTimeout(function(){t.hideContainer()},150)},onVerticalArrow:function(t){var e,s="up"===t?"prev":"next",i=this.$list.find("."+h.getClassname("highlight"));!this.$list.is(":visible")&&this.lastTerm.length>=this.options.minLength&&this.$list.show(),e=i.length?i.removeClass(h.getClassname("highlight"))[s]().addClass(h.getClassname("highlight")):this.$list.find("."+h.getClassname("option")).first().addClass(h.getClassname("highlight")),this.setValue(e)},prepareContainer:function(){var e=t("<ul></ul>");this.setPosition(e),e.attr("id",this.id).addClass(h.getClassname("select")).css("display","none").appendTo("body"),this.$list=e},prepareSource:function(){var e=this,s=/^(http|https|\/|\.\/|\.\.\/)/,i=this.options.service;this.source=i,"string"==typeof i&&(s.test(i)?this.source=function(){var s=e.serializeForm(),a={type:this.options.type,formdata:s};a[this.options.searchTerm]=this.lastTerm;var n;t.ajax({url:i,dataType:"json",type:this.options.queryType,data:a,success:function(t){n=e.options.customProp?t[e.options.customProp]:t;var s=t.itemList||n;e.showResults(s)}})}:this.source=h.getStringVariable(i))},search:function(){var e,s=this,i=this.source.itemList?this.source.itemList:this.source;return this.startLoading(),this.isCached()?void this.showResults(this.terms[this.lastTerm]):"function"==typeof i?i.apply(this):(e=t.map(i,function(t){if(s.searchArray(t,s.lastTerm))return t}),void this.showResults(e))},searchArray:function(t,e){return t.name.toLowerCase().indexOf(e)>-1},showResults:function(e){var s=this.compileTemplate(e);h.callback(this.options.onSearch),this.cache(e),t("#"+this.id).html(s).show(),this.stopLoading()},setPosition:function(t){var e=this.$el.offset(),s=e.top+this.el.offsetHeight,i=e.left,a=this.el.offsetWidth;return t.css({top:s,left:i,minWidth:a})},hideContainer:function(){t("#"+this.id).delay(100).hide()},compileTemplate:function(e){var s=this,i=[],a=Handlebars.compile(this.template.item),n=!!this.template.head&&Handlebars.compile(this.template.head),o="";return t.each(e.slice(0,this.options.item),function(e,r){var l;if(l=s.renderItem(r,a),("category"===s.options.type||"tree"===s.options.type)&&"undefined"!=typeof r.category&&r.category!==o){var c=t(n(r));c.addClass(h.getClassname("category")).attr("role","presentation"),i.push(c),o=r.category}i.push(l)}),i},renderItem:function(e,s){var i=this,a=s(e);return i.options.highlight===!0&&(a=a.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+i.lastTerm+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="'+h.getClassname("matched")+'">$1</span>')),t(a).addClass(h.getClassname("option")).data("uxrAutocompleteItem",e).attr("role","presentation")},serializeForm:function(){return t(this.options.formdata).serialize()},cache:function(t){this.options.cache===!0&&(this.terms[this.lastTerm]=t)},isCached:function(){var t=!1;return void 0!==this.terms[this.lastTerm]&&(t=!0),t},clearCache:function(){return e.clearCache(this.el)},update:function(t){return e.update(this.el,t)},destroy:function(){return e.destroy(this.el)},cleanUp:function(){t("."+h.getClassname("wrap")+"-"+this._instance).remove(),this.removeContainer()}});var h={callback:function(t){if("function"==typeof t)t.apply(this);else if(t!==!1){var e=function(){return t};e()}},getStringVariable:function(t){var e;if(t.indexOf(".")>-1){for(var s=t.split("."),i=window[s[0]],a=1;a<s.length;a++)i=i[s[a]];e=i}else e=window[t];return e},getClassname:function(t){return l.prefix+l.name+"-"+l.classes[t]},debounce:function(t,e,s){var i;return function(){var a=this,n=arguments,o=function(){i=null,s||t.apply(a,n)},r=s&&!i;clearTimeout(i),i=setTimeout(o,e),r&&t.apply(a,n)}}};e=t.fn.autocomplete=t.fn.uxrautocomplete=t.fn.uxitdautocomplete=t.uxrautocomplete=function(e){var s=this.selector;return this.each(function(){t.data(this,l.data)||t.data(this,l.data,new c(this,e,s))})},e.clearCache=function(e){var s=t(void 0!==e?e:"."+h.getClassname("ready"));s.each(function(){var e=t(this).data(l.data);e.terms={},h.callback(e.options.onClearCache)})},e.update=function(s,i){var a,n;"undefined"==typeof i&&"object"==typeof s?(a=t("."+h.getClassname("ready")),n=s):(a=t(s),n=i),a.filter("input").each(function(){var s=t(this),i=s.data(l.data),a=i.options;i.options=t.extend(!0,{},a,n),i.options.cache||e.clearCache(s),i.setTemplate(),h.callback(a.onUpdate)})},e.destroy=function(e){var s=t(void 0!==e?e:"."+h.getClassname("ready"));s.filter("input").each(function(){var e=t(this),s=e.data(l.data),i=e.data(l.rocket);s.removeClasses(),s.unbindUIActions(),s.removeLayout(),s.removeContainer(),e.removeData(l.data),delete i[l.data],e.data(l.rocket,i),h.callback(s.options.onRemove)})},e.version="2.0.4",e.settings=a,e.templates=n,e.namespace=l});