/*! UX Rocket Autocomplete 
 *  UX Rocket Autocomplete: A jQueryUI autocomplete wrapper 
 *  @author Bilal Cinarli <bcinarli@gmail.com> (http://bcinarli.com/) 
 *  @version 2.0.2 
 *  @build Fri Jan 13 2017 15:17:52 GMT+0300 (MSK) 
 */
!function(t){"use strict";"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports&&"function"==typeof require?require("jquery"):jQuery)}(function(t){"use strict";var e,s=1,a="uxrAutocomplete",i={type:"list",item:10,service:null,minLength:2,queryType:"GET",formdata:null,hidden:null,template:null,highlight:!0,arrowSelection:!1,arrowNavigation:!0,cache:!1,onReady:!1,onSearch:!1,onSelect:function(t){},onEnter:!1,onButtonClick:!1,onClearCache:!1,onUpdate:!1,onRemove:!1},n={list:{item:'<li class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       {{{name}}}   </a></li>'},image:{item:'<li class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       <span class="item-image"><img src="{{image}}"/></span>        {{{name}}}   </a></li>'},category:{head:'<li class="uxr-autocomplete-category">   <span class="uxr-autocomplete-category-head" title="{{category}}">{{category}}</span></li>',item:'<li class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       {{{name}}}   </a></li>'},tree:{head:'<li class="uxr-autocomplete-category">   <span class="uxr-autocomplete-category-head" title="{{category}}">{{category}}</span></li>',item:'<li class="uxr-autocomplete-list-item">   <a {{#if url}}href="{{url}}"{{/if}}>       <span class="item-image"><img src="{{image}}"/></span>        {{{name}}}   </a></li>'}},o={click:"click."+a,keyup:"keyup."+a,input:"input."+a,blur:"blur."+a},r={codes:{13:"return",27:"esc",37:"left",38:"up",39:"right",40:"down"},"return":13,esc:27,left:37,up:38,right:39,down:40},l={prefix:"uxr-",rocket:"uxRocket",data:a,name:"autocomplete",wrap:"uxr-plugin-wrap",classes:{wrap:"wrap",ready:"ready",magnify:"magnify",loading:"loading",select:"select",category:"category",option:"option",matched:"matched",highlight:"highlight",selected:"selected"}},c=function(e,n,o){var r=t(e);this._instance=s,this._name=a,this._defaults=i,this.el=e,this.$el=r,this.id="uxr-autocomplete-select-"+s,this.selector=o,this.terms={},this.options=t.extend(!0,{},i,n,r.data()),s++,this.lastTerm=null,this.init()};t.extend(c.prototype,{init:function(){var t=this.$el.data(l.rocket)||{};this.$el.addClass(h.getClassname("ready")),t[l.data]={hasWrapper:!0,wrapper:l.wrap,ready:h.getClassname("ready"),selector:this.selector,options:this.options},this.$el.data(l.rocket,t),this.setLayout(),this.prepareContainer(),this.prepareSource(),h.callback(this.options.onReady),this.bindUIActions(),this.setTemplate()},handleClasses:function(){this.classList=this.$el.context.className.replace(h.getClassname("ready"),""),"."===this.selector.charAt(0)&&(this.classList=this.classList.replace(this.selector.substr(1),"")),this.classList+=l.wrap+" "+h.getClassname("wrap")+" "+h.getClassname("wrap")+"-"+this._instance,this.classList=t.trim(this.classList)},removeClasses:function(){this.$el.removeClass(h.getClassname("ready")),this.$el.parent().removeClass(this.classList.replace(l.wrap,""))},handleWrapper:function(){this.$el.parent().is("."+l.wrap)?this.$el.parent().addClass(this.classList):this.$el.wrap('<span class="'+this.classList+'"></span>')},addIcon:function(){this.$el.after('<i class="'+h.getClassname("magnify")+'"></i>'),this.$icon=this.$el.next("."+h.getClassname("magnify"))},setLayout:function(){this.handleClasses(),this.handleWrapper(),this.addIcon()},startLoading:function(){this.$icon.addClass(h.getClassname("loading"))},stopLoading:function(){this.$icon.removeClass(h.getClassname("loading"))},removeLayout:function(){var t=this,e=t.$el.data(l.rocket);Object.keys&&1===Object.keys(e).length?t.$el.unwrap():t.$el.parent().removeClass(l.wrap),t.$el.next("."+h.getClassname("magnify")).remove()},removeContainer:function(){t("#"+this.id).remove()},setTemplate:function(){this.template=null,null===this.options.template?this.template=n[this.options.type]||n.list:this.template=this.options.template},bindUIActions:function(){var e=this;e.$el.on(o.keyup+" "+o.input,function(s){var a=t(this).val(),i=a.length;i>=e.options.minLength&&e.onKeyup(s),0===i&&e.hideContainer()}),e.$el.on(o.blur,function(){e.onBlur()}),e.$list.on(o.click,"."+h.getClassname("option"),function(t){t.preventDefault(),e.select(t)}),t("body").on("DOMNodeRemoved",function(t){t.target===e.el&&e.cleanUp()})},select:function(e){var s=e instanceof jQuery?e:t(e.currentTarget);s.siblings().removeClass(h.getClassname("selected")).end().addClass(h.getClassname("selected")),this.setValue(s),this.hideContainer(),h.callback(this.options.onSelect(s))},setValue:function(t){var e=t.text().trim();""===e&&(e=this.lastTerm),this.$el.val(e)},unbindUIActions:function(){this.$el.off("."+a)},onKeyup:function(t){t.keyCode===r.up||t.keyCode===r.down?this.onVerticalArrow(r.codes[t.keyCode]):t.keyCode===r["return"]?this.$list.is(":visible")&&this.select(this.$list.find("."+h.getClassname("highlight"))):t.keyCode===r.esc?this.hideContainer():(this.lastTerm=this.$el.val().toLowerCase(),this.search())},onBlur:function(){var t=this;setTimeout(function(){t.hideContainer()},150)},onVerticalArrow:function(t){var e,s="up"===t?"prev":"next",a=this.$list.find("."+h.getClassname("highlight"));!this.$list.is(":visible")&&this.lastTerm.length>=this.options.minLength&&this.$list.show(),e=a.length?a.removeClass(h.getClassname("highlight"))[s]().addClass(h.getClassname("highlight")):this.$list.find("."+h.getClassname("option")).first().addClass(h.getClassname("highlight")),this.setValue(e)},prepareContainer:function(){var e=t("<ul></ul>");this.setPosition(e),e.attr("id",this.id).addClass(h.getClassname("select")).css("display","none").appendTo("body"),this.$list=e},prepareSource:function(){var e=this,s=/^(http|https|\/|\.\/|\.\.\/)/,a=this.options.service;this.source=a,"string"==typeof a&&(s.test(a)?this.source=function(){var s=e.serializeForm();t.ajax({url:a,dataType:"json",type:this.options.queryType,data:{term:this.lastTerm,type:this.options.type,formdata:s},success:function(t){var s=t.itemList||t;e.showResults(s)}})}:this.source=h.getStringVariable(a))},search:function(){var e,s=this,a=this.source.itemList?this.source.itemList:this.source;return this.startLoading(),this.isCached()?void this.showResults(this.terms[this.lastTerm]):"function"==typeof a?a.apply(this):(e=t.map(a,function(t){if(s.searchArray(t,s.lastTerm))return t}),void this.showResults(e))},searchArray:function(t,e){return t.name.toLowerCase().indexOf(e)>-1},showResults:function(e){var s=this.compileTemplate(e);h.callback(this.options.onSearch),this.cache(e),t("#"+this.id).html(s).show(),this.stopLoading()},setPosition:function(t){var e=this.$el.offset(),s=e.top+this.el.offsetHeight,a=e.left,i=this.el.offsetWidth;return t.css({top:s,left:a,minWidth:i})},hideContainer:function(){t("#"+this.id).delay(100).hide()},compileTemplate:function(e){var s=this,a=[],i=Handlebars.compile(this.template.item),n=!!this.template.head&&Handlebars.compile(this.template.head),o="";return t.each(e.slice(0,this.options.item),function(e,r){var l;if(l=s.renderItem(r,i),("category"===s.options.type||"tree"===s.options.type)&&"undefined"!=typeof r.category&&r.category!==o){var c=t(n(r));c.addClass(h.getClassname("category")).attr("role","presentation"),a.push(c),o=r.category}a.push(l)}),a},renderItem:function(e,s){var a=this,i=s(e);return a.options.highlight===!0&&(i=i.replace(new RegExp("(?![^&;]+;)(?!<[^<>]*)("+a.lastTerm+")(?![^<>]*>)(?![^&;]+;)","gi"),'<span class="'+h.getClassname("matched")+'">$1</span>')),t(i).addClass(h.getClassname("option")).data("uxrAutocompleteItem",e).attr("role","presentation")},serializeForm:function(){return t(this.options.formdata).serialize()},cache:function(t){this.options.cache===!0&&(this.terms[this.lastTerm]=t)},isCached:function(){var t=!1;return void 0!==this.terms[this.lastTerm]&&(t=!0),t},clearCache:function(){return e.clearCache(this.el)},update:function(t){return e.update(this.el,t)},destroy:function(){return e.destroy(this.el)},cleanUp:function(){t("."+h.getClassname("wrap")+"-"+this._instance).remove(),this.removeContainer()}});var h={callback:function(t){if("function"==typeof t)t.apply(this);else if(t!==!1){var e=function(){return t};e()}},getStringVariable:function(t){var e;if(t.indexOf(".")>-1){for(var s=t.split("."),a=window[s[0]],i=1;i<s.length;i++)a=a[s[i]];e=a}else e=window[t];return e},getClassname:function(t){return l.prefix+l.name+"-"+l.classes[t]}};e=t.fn.autocomplete=t.fn.uxrautocomplete=t.uxrautocomplete=function(e){var s=this.selector;return this.each(function(){t.data(this,l.data)||t.data(this,l.data,new c(this,e,s))})},e.clearCache=function(e){var s=t(void 0!==e?e:"."+h.getClassname("ready"));s.each(function(){var e=t(this).data(l.data);e.terms={},h.callback(e.options.onClearCache)})},e.update=function(s,a){var i,n;"undefined"==typeof a&&"object"==typeof s?(i=t("."+h.getClassname("ready")),n=s):(i=t(s),n=a),i.filter("input").each(function(){var s=t(this),a=s.data(l.data),i=a.options;a.options=t.extend(!0,{},i,n),a.options.cache||e.clearCache(s),a.setTemplate(),h.callback(i.onUpdate)})},e.destroy=function(e){var s=t(void 0!==e?e:"."+h.getClassname("ready"));s.filter("input").each(function(){var e=t(this),s=e.data(l.data),a=e.data(l.rocket);s.removeClasses(),s.unbindUIActions(),s.removeLayout(),s.removeContainer(),e.removeData(l.data),delete a[l.data],e.data(l.rocket,a),h.callback(s.options.onRemove)})},e.version="2.0.3",e.settings=i,e.templates=n,e.namespace=l});